# 構造比較アイデア
類似した形式の2つのデータファイル間に存在する構造的・統計的差異を把握し、可視化・定量化するためのアイデアを整理する。
主な対象は、データ生成後の品質検証や、構造比較によるデータ整合性の確認など。

## 1. 列マップの作成（指標適用性マップ）
- 目的：
各列が持つ構造的特徴に応じて、比較に用いるべき指標を切り替えられないか。
一律な処理では対応できない列の多様性を吸収する。

- 検討軸：
データ型（カテゴリ・数値・日付など）
値の種類（定数、ユニーク値、分布に偏りがあるか等）
構造的意味（ID列、フラグ列、スコア列など）

- 活用例：
値の分布比較にはJS DivergenceやKL Divergence
並び順の乱雑さにはMRDやPE
特定列のみ対象とするための include / exclude マップの定義

## 2. 総合スコアの作成
- 目的：
複数の指標結果を統合し、1列ごとの評価・全体評価をわかりやすく定量化する。

- 設計方針：
使用指標に対して重みを割り振り、加重平均または論理積的な統合方式を検討。
一部の指標が未評価となるケース（たとえば適用対象外）を許容するスキームを併用。
指標数に応じた評価モード（全指標使用／一部指標のみ）を表示する。

- 例：
```
if 3指標評価 → threshold = 0.90
if 2指標評価 → threshold = 0.85
```

- 補足：ユーティリティ・再識別リスクなど、目的別にスコア構成を変えることも可能。

## 3. トレーサビリティ確保のために
- 目的：
実行結果の再現性を確保し、比較結果に対する根拠を後から検証可能にする。

- 設計案：
すべてのステップにおける入出力、設定ファイル、使用指標、実行ハッシュ、タイムスタンプ等をログ・CSV・メタファイルとして出力。
評価対象列ごとの比較ステータス（評価済／スキップ／不適）を記録。
評価時に使用された閾値や指標の種類も同時記録。

- 出力例：
```
step, column, status, metric_used, value, threshold, passed
4-P, age, calculated, JS, 0.02, 0.05, TRUE
```